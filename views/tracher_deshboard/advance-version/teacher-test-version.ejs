<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Teacher's Advanced Dashboard with Test Services</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/teacher-advance.css">
</head>

<body>
    <div class="main-container">
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        <!-- Fixed Header -->
        <header>
            <button id="toggleSidebar" class="toggle-btn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <i class="fas fa-chalkboard-teacher"></i>
                <h1>Teacher's Advanced Dashboard</h1>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <i class="fas fa-user" id="avatarIcon"></i>
                </div>
                <div>
                    <div>Welcome, <strong>
                            <%= teacher.name %>
                        </strong></div>

                    <div style="font-size: 0.9rem;" id="account-status">Free Account</div>
                </div>
            </div>

        </header>
        <!-- Sticky Top Navbar -->
        <div class="top-navbar">
            <ul>
                <li><a href="#" id="top-nav-payment"><i class="fas fa-credit-card"></i> Payment</a></li>
                <li><a href="#" id="top-nav-dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" id="top-nav-tests"><i class="fas fa-file-alt"></i> Create Tests</a></li>
                <li><a href="#" id="top-nav-templates"><i class="fas fa-layer-group"></i> Templates</a></li>
                <li><a href="#" id="top-nav-services"><i class="fas fa-clipboard-list"></i> Test Services</a>
                </li>
                <li><a href="#" id="top-nav-python"><i class="fab fa-python"></i> Python Tests</a></li>
                <li><a href="#" id="top-nav-settings"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
        </div>

        <div class="main-content">
            <!-- Fixed Sidebar -->
            <nav class="sidebar" id="sidebar">
                <h3>Navigation</h3>
                <ul class="nav-menu">
                    <li class="nav-item active" id="nav-payment">
                        <a href="#">
                            <i class="fas fa-credit-card"></i>
                            <span>Payment</span>
                        </a>
                    </li>
                    <li class="nav-item locked" id="nav-dashboard">
                        <a href="#">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>
                    <li class="nav-item locked" id="nav-tests">
                        <a href="#">
                            <i class="fas fa-file-alt"></i>
                            <span>Create Tests</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>
                    <li class="nav-item locked" id="nav-templates">
                        <a href="#">
                            <i class="fas fa-layer-group"></i>
                            <span>Templates</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>

                    <li class="nav-item locked" id="nav-test-services">
                        <a href="#">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Test Services</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>

                    <li class="nav-item locked" id="nav-python">
                        <a href="#">
                            <i class="fab fa-python"></i>
                            <span>Python Tests</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>
                    <li class="nav-item locked" id="nav-analytics">
                        <a href="#">
                            <i class="fas fa-chart-bar"></i>
                            <span>Analytics</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>
                    <li class="nav-item locked" id="nav-settings">
                        <a href="#">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                            <i class="fas fa-lock lock-icon"></i>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Content Area -->
            <div class="content-area">

                <!-- Scrollable Content -->
                <div class="page-content-wrapper">
                    <!-- Payment Section -->
                    <div id="payment-section">
                        <div class="page-title">
                            <i class="fas fa-credit-card"></i>
                            <h2>Complete Payment to Access All Features</h2>
                        </div>

                        <div class="card payment-section">
                            <div class="payment-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <h3>Upgrade to Premium Version</h3>
                            <p><strong>Current Status: <span id="current-status">Free Account (Limited
                                        Features)</span></strong></p>
                            <p>Complete payment to unlock all premium features including:</p>
                            <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                                <li>Unlimited Test Creation</li>
                                <li>Test Services Dashboard</li>
                                <li>Automatic Template Creation</li>
                                <li>Python Test Service</li>
                                <li>View All Tests by Template</li>
                                <li>Advanced Analytics</li>
                                <li>Priority Support</li>
                            </ul>
                            <p><strong>Total: $49.99/year (One Time Payment)</strong></p>
                            <button class="payment-btn" id="make-payment">
                                <i class="fas fa-lock-open"></i> Complete Payment Now
                            </button>
                            <div style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                                <i class="fas fa-info-circle"></i> After payment, all features will be unlocked
                                immediately
                            </div>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-ban"></i> Currently Locked Features</h3>
                            <div class="service-stats">
                                <div class="stat-card">
                                    <div class="stat-number">0</div>
                                    <div>Tests Created</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number">0</div>
                                    <div>Templates Available</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number">0</div>
                                    <div>Subjects Unlocked</div>
                                </div>
                            </div>
                            <p style="text-align: center; margin-top: 15px; color: #e74c3c;">
                                <i class="fas fa-exclamation-triangle"></i> Complete payment to unlock these features
                            </p>
                        </div>
                    </div>

                    <!-- Dashboard Section with Animations -->
                    <div id="dashboard-section" class="hidden fade-in-up">
                        <div class="lock-overlay" id="dashboard-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Dashboard Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to access the advanced dashboard.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;"
                                    id="goto-payment-from-dashboard">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <div class="page-title">
                            <i class="fas fa-tachometer-alt"></i>
                            <h2>Advanced Dashboard</h2>
                        </div>

                        <!-- Welcome Card with Animation -->
                        <div class="dashboard-welcome">
                            <div class="welcome-icon pulse">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <h1 class="welcome-title">Welcome to Your Teaching Dashboard</h1>
                            <p class="welcome-text">
                                Monitor your teaching progress, track student engagement, and manage all your tests
                                from one centralized dashboard. Everything you need to streamline your teaching
                                workflow.
                            </p>
                        </div>

                        <!-- Animated Stats Cards -->
                        <div class="animated-stats-grid">
                            <div class="animated-stat-card">
                                <i class="fas fa-file-alt" style="color: #3498db; font-size: 1.3rem;"></i>
                                <div class="animated-stat-number" id="total-tests">0</div>
                                <div class="animated-stat-label">Total Tests Created</div>
                                <div class="progress-container">
                                    <div class="progress-label">
                                        <span>Progress</span>
                                        <span id="tests-progress-text">0%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill tests" id="tests-progress">
                                            <div class="progress-value" id="tests-progress-value">0%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="animated-stat-card">
                                <i class="fas fa-question-circle" style="color: #2ecc71; font-size: 1.3rem;"></i>
                                <div class="animated-stat-number" id="total-questions">0</div>
                                <div class="animated-stat-label">Total Questions Created</div>
                                <div class="progress-container">
                                    <div class="progress-label">
                                        <span>Progress</span>
                                        <span id="questions-progress-text">0%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill questions" id="questions-progress">
                                            <div class="progress-value" id="questions-progress-value">0%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="animated-stat-card">
                                <i class="fas fa-layer-group" style="color: #9b59b6; font-size: 1.3rem;"></i>
                                <div class="animated-stat-number" id="active-templates">0</div>
                                <div class="animated-stat-label">Active Templates</div>
                                <div class="progress-container">
                                    <div class="progress-label">
                                        <span>Progress</span>
                                        <span id="templates-progress-text">0%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill templates" id="templates-progress">
                                            <div class="progress-value" id="templates-progress-value">0%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chart Section -->
                        <div class="chart-container">
                            <div class="chart-title">
                                <i class="fas fa-chart-line"></i>
                                <span>Monthly Test Creation Activity</span>
                            </div>
                            <div class="chart" id="activity-chart">
                                <!-- Chart bars will be dynamically created -->
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="recent-activity">
                            <div class="page-title">
                                <i class="fas fa-history"></i>
                                <h2>Recent Activity</h2>
                            </div>
                            <ul class="activity-list" id="recent-activity-list">
                                <!-- Activity items will be dynamically added here -->
                            </ul>
                        </div>
                    </div>

                    <!-- Create Tests Section -->
                    <div id="create-test-section" class="hidden">
                        <div class="lock-overlay" id="create-test-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Test Creation Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to create unlimited tests.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;" id="goto-payment-from-tests">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <div class="page-title">
                            <i class="fas fa-file-alt"></i>
                            <h2>Create New Test Cards</h2>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-plus-circle"></i> Test Details</h3>
                            <form id="test-creation-form" class="test-form">
                                <div class="form-group">
                                    <label for="test-name">Test Name</label>
                                    <input type="text" id="test-name" placeholder="Enter test name" required disabled>
                                </div>

                                <div class="form-group">
                                    <label for="test-subject">Subject (Type any subject)</label>
                                    <input type="text" id="test-subject"
                                        placeholder="Enter any subject (e.g., Mathematics, Science, etc.)" required
                                        disabled>
                                </div>

                                <div class="form-group">
                                    <label for="test-duration">Duration (minutes)</label>
                                    <input type="number" id="test-duration" min="5" max="180" value="60" disabled>
                                </div>

                                <div class="form-group">
                                    <label for="test-difficulty">Difficulty Level</label>
                                    <select id="test-difficulty" disabled>
                                        <option value="Beginner">Beginner</option>
                                        <option value="Intermediate" selected>Intermediate</option>
                                        <option value="Advanced">Advanced</option>
                                    </select>
                                </div>

                                <div class="form-group full-width">
                                    <label for="test-description">Test Description</label>
                                    <textarea id="test-description" placeholder="Describe what this test covers..."
                                        disabled></textarea>
                                </div>

                                <!-- Questions Display -->
                                <div class="form-group full-width" id="questions-display">
                                    <label>Questions Added: <span id="question-count">0</span></label>
                                    <div id="question-preview"
                                        style="max-height: 150px; overflow-y: auto; margin-top: 10px; padding: 10px; border: 1px solid #eee; border-radius: 5px; background-color: #f9f9f9;">
                                        <!-- Questions will be displayed here -->
                                    </div>
                                    <button type="button" class="btn" id="manage-questions-btn"
                                        style="margin-top: 10px; background-color: #f0f0f0; color: #333;" disabled>
                                        <i class="fas fa-edit"></i> Manage Questions
                                    </button>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary disabled" id="reset-form"
                                        disabled>Reset
                                        Form</button>
                                    <button type="submit" class="btn btn-primary disabled" disabled>Create Test
                                        Cards</button>
                                    <button type="button" class="btn btn-success disabled create-test-card-btn"
                                        id="create-test-card-btn" disabled>
                                        <i class="fas fa-plus-circle"></i> Create Test Card Only
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Quick Create Section -->
                        <div class="quick-create-section">
                            <h3><i class="fas fa-bolt"></i> Quick Create Test Card</h3>
                            <p>Quickly create a test card without filling the full form:</p>

                            <div class="quick-create-form">
                                <div class="quick-create-input">
                                    <label for="quick-test-name">Test Name</label>
                                    <input type="text" id="quick-test-name" placeholder="Enter test name" disabled>
                                </div>

                                <div class="quick-create-input">
                                    <label for="quick-subject">Subject</label>
                                    <input type="text" id="quick-subject" placeholder="Enter any subject" disabled>
                                </div>

                                <div class="quick-create-input">
                                    <label>Card Color</label>
                                    <div class="color-options" id="color-options">
                                        <div class="color-option selected" style="background-color: #e34f26;"
                                            data-color="#e34f26"></div>
                                        <div class="color-option" style="background-color: #1572b6;"
                                            data-color="#1572b6">
                                        </div>
                                        <div class="color-option" style="background-color: #f7df1e;"
                                            data-color="#f7df1e">
                                        </div>
                                        <div class="color-option" style="background-color: #339933;"
                                            data-color="#339933">
                                        </div>
                                        <div class="color-option" style="background-color: #9b59b6;"
                                            data-color="#9b59b6">
                                        </div>
                                        <div class="color-option" style="background-color: #e74c3c;"
                                            data-color="#e74c3c">
                                        </div>
                                        <div class="color-option" style="background-color: #1abc9c;"
                                            data-color="#1abc9c">
                                        </div>
                                    </div>
                                </div>

                                <button type="button" class="quick-create-btn disabled" id="quick-create-btn" disabled>
                                    <i class="fas fa-plus"></i> Quick Create
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Test Services Section -->
                    <div id="test-services-section" class="hidden">
                        <div class="lock-overlay" id="test-services-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Test Services Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to access Test Services.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;"
                                    id="goto-payment-from-test-services">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <!-- Main Test Services Dashboard -->
                        <div id="test-services-main-dashboard">
                            <div class="services-header">
                                <div class="page-title">
                                    <i class="fas fa-clipboard-list"></i>
                                    <h2>Explore Test Services</h2>
                                </div>
                                <div class="user-info">
                                    <div style="font-size: 1rem;">
                                        Total Courses: <strong id="total-courses-count">8</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="cards-container" id="courses-container">
                                <!-- Courses will be dynamically added here -->
                            </div>

                            <footer>
                                <p>&copy; 2023 Programming Courses Dashboard. All rights reserved.</p>
                                <p>Total Courses Available: <span id="footer-courses-count">8</span> | Last Updated:
                                    Today
                                </p>
                            </footer>
                        </div>

                        <!-- Test Services Page -->
                        <div class="service-page" id="test-services-page">
                            <div class="services-header">
                                <div class="page-title">
                                    <i class="fas fa-laptop-code"></i>
                                    <h2 id="service-page-title">Test Services</h2>
                                </div>
                                <button class="back-btn" id="back-to-dashboard">
                                    <i class="fas fa-arrow-left"></i> Back to Courses
                                </button>
                            </div>

                            <div class="service-header" id="service-header">
                                <div class="service-icon" id="service-icon">
                                    <i class="fab fa-html5"></i>
                                </div>
                                <h1 class="service-title" id="service-title">HTML Test Services</h1>
                                <p class="service-description" id="service-description">
                                    Explore all test services available for HTML. From beginner to advanced level tests.
                                </p>
                            </div>

                            <div class="test-services-container" id="test-services-container">
                                <!-- Test services will be dynamically added here -->
                            </div>

                            <footer>
                                <p>&copy; 2023 Programming Courses Dashboard. All rights reserved.</p>
                                <p id="service-footer-text">Test Services for HTML</p>
                            </footer>
                        </div>
                    </div>

                    <!-- Templates Section -->
                    <div id="templates-section" class="hidden">
                        <div class="lock-overlay" id="templates-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Templates Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to access all templates.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;"
                                    id="goto-payment-from-templates">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <div class="page-title">
                            <i class="fas fa-layer-group"></i>
                            <h2>Subject Templates</h2>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-clipboard-list"></i> All Subject Templates</h3>
                            <p>Click on any template to view all tests created from that template.</p>

                            <div class="service-stats">
                                <div class="stat-card">
                                    <div class="stat-number" id="template-test-count">0</div>
                                    <div>Total Tests Created</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="template-question-count">0</div>
                                    <div>Total Questions Created</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="template-subject-count">0</div>
                                    <div>Subjects with Templates</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Python Test Service Section -->
                    <div id="python-service-section" class="hidden">
                        <div class="lock-overlay" id="python-service-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Python Service Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to access Python Test Service.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;" id="goto-payment-from-python">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <div class="page-title">
                            <i class="fab fa-python"></i>
                            <h2>Python Test Service</h2>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-folder"></i> All Python Tests</h3>
                            <p>This section displays all Python tests you have created.</p>
                        </div>
                    </div>

                    <!-- Analytics Section -->
                    <div id="analytics-section" class="hidden">
                        <div class="lock-overlay" id="analytics-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Analytics Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to access advanced analytics.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;"
                                    id="goto-payment-from-analytics">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <div class="page-title">
                            <i class="fas fa-chart-bar"></i>
                            <h2>Advanced Analytics</h2>
                        </div>

                        <div class="card">
                            <h3><i class="fas fa-chart-pie"></i> Performance Analytics</h3>
                            <p>View detailed analytics about your tests, student performance, and engagement metrics.
                            </p>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div id="settings-section" class="hidden">
                        <div class="lock-overlay" id="settings-lock">
                            <div class="lock-message">
                                <div class="lock-icon-large">
                                    <i class="fas fa-lock"></i>
                                </div>
                                <h3>Settings Locked</h3>
                                <p>This feature is only available after payment.</p>
                                <p>Please complete the payment to access settings.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;"
                                    id="goto-payment-from-settings">
                                    <i class="fas fa-credit-card"></i> Go to Payment
                                </button>
                            </div>
                        </div>

                        <div class="page-title">
                            <i class="fas fa-cog"></i>
                            <h2>Settings</h2>
                        </div>

                        <div class="settings-container">
                            <!-- Profile Settings -->
                            <div class="card">
                                <h3><i class="fas fa-user-circle"></i> Profile Settings</h3>
                                <div class="profile-settings">
                                    <div class="profile-image-container">
                                        <img id="profile-image" class="profile-image" src="" alt="Profile Photo">
                                        <button class="profile-upload-btn" id="uploadProfileBtn">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                        <input type="file" id="profile-photo-input" class="file-input" accept="image/*">
                                    </div>
                                    <div class="profile-info">
                                        <p><strong>Name:</strong>
                                            <%= teacher.name %>
                                        </p>
                                        <p><strong>Email:</strong>
                                            <%= teacher.email %>
                                        </p>

                                        <p><strong>Account Type:</strong> <span id="settings-account-type">Free
                                                Account</span></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Account Settings -->
                            <div class="card">
                                <h3><i class="fas fa-user-cog"></i> Account Settings</h3>
                                <form class="settings-form">
                                    <div class="form-group">
                                        <label for="display-name">Display Name</label>
                                        <input type="text" id="display-name" value="<%= teacher.name %>">
                                    </div>

                                    <div class="form-group">
                                        <label for="email">Email Address</label>
                                        <input type="email" id="email" value="<%= teacher.email %>">
                                    </div>

                                    <div class="form-group">
                                        <label for="timezone">Timezone</label>
                                        <select id="timezone">
                                            <option value="UTC-5">Eastern Time (ET)</option>
                                            <option value="UTC-6">Central Time (CT)</option>
                                            <option value="UTC-7">Mountain Time (MT)</option>
                                            <option value="UTC-8" selected>Pacific Time (PT)</option>
                                        </select>
                                    </div>
                                    <button type="button" class="btn btn-primary" id="save-profile-btn">
                                        <i class="fas fa-save"></i> Save Profile Changes
                                    </button>
                                </form>
                            </div>

                            <!-- Notification Settings -->
                            <div class="card">
                                <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="email-notifications" checked>
                                        <span>Email Notifications</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="test-reminders" checked>
                                        <span>Test Reminders</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="feature-updates">
                                        <span>New Feature Announcements</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="student-submissions">
                                        <span>Student Submission Alerts</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Theme Settings -->
                            <div class="card">
                                <h3><i class="fas fa-palette"></i> Theme Settings</h3>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="theme" value="light" checked>
                                        <span>Light Theme</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="theme" value="dark">
                                        <span>Dark Theme</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="theme" value="auto">
                                        <span>Auto (Follow System)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Create Test -->
    <div class="modal" id="createTestModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Test Questions</h2>
                <button class="close-btn" onclick="closeModal('createTestModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="question-section">
                    <h3>üëáüèªüëáüèª Create Test Questions üëáüèªüëáüèª</h3>

                    <div class="question-list" id="questionList">
                        <!-- Questions will be added here -->
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-question-circle"></i>
                            <p>No questions added yet. Add your first question below.</p>
                        </div>
                    </div>

                    <div class="question-form">
                        <h3><b>Add New Question</b></h3>

                        <div class="form-group">
                            <label><b>Question Type</b></label>
                            <select class="form-control" id="questionType">
                                <option value="multiple-choice">Multiple Choice (MCQ)</option>
                                <option value="true-false">True/False</option>
                                <option value="short-answer">Short Answer</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label><b>Write Your Question ‚úçÔ∏è‚úçÔ∏è</b></label>
                            <textarea class="form-control" id="questionText" rows="3"
                                placeholder="Enter your question..."></textarea>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-secondary" onclick="translateAuto()">
                                <i class="fas fa-language"></i> Auto Translate
                            </button>
                        </div>


                        <div id="optionsContainer" style="display: block;">
                            <div class="form-group">
                                <label><b>Options (For MCQ)</b></label>
                                <div id="optionsList">
                                    <div class="question-option-input">
                                        <input type="radio" name="correctOption" value="0">
                                        <input type="text" class="form-control" placeholder="Option A" id="option0">
                                    </div>
                                    <div class="question-option-input">
                                        <input type="radio" name="correctOption" value="1">
                                        <input type="text" class="form-control" placeholder="Option B" id="option1">
                                    </div>
                                    <div class="question-option-input">
                                        <input type="radio" name="correctOption" value="2">
                                        <input type="text" class="form-control" placeholder="Option C" id="option2">
                                    </div>
                                    <div class="question-option-input">
                                        <input type="radio" name="correctOption" value="3">
                                        <input type="text" class="form-control" placeholder="Option D" id="option3">
                                    </div>
                                </div>
                                <button type="button" class="btn" id="addOptionBtn"
                                    style="margin-top: 10px; background-color: #f0f0f0;">
                                    <i class="fas fa-plus"></i> Add More Options
                                </button>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Marks for this Question *</label>
                                <input type="number" class="form-control" id="questionPoints" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label>Question Difficulty</label>
                                <select class="form-control" id="questionDifficulty">
                                    <option value="Easy">Easy</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="Hard">Hard</option>
                                </select>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="addQuestionBtn" style="width: 100%;">
                            <i class="fas fa-plus"></i> Add Question to Test
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createTestModal')">Cancel</button>
                <button class="btn btn-success" id="saveQuestionsBtn">
                    <i class="fas fa-save"></i> Save All Questions
                </button>
            </div>
        </div>
    </div>

    <script>
        // State management
        const state = {
            paymentCompleted: false,
            tests: [],
            templates: [],
            questions: [],
            currentTestQuestions: [],
            currentSection: 'payment-section',
            selectedColor: "#e34f26",
            dashboardAnimationsPlayed: false,
            profilePhoto: null
        };

        // Course Data
        const coursesData = [

        ];

        // Test Services Data for each course
        const testServicesData = {

        };

        // Recent Activity Data
        const recentActivityData = [
            {
                id: 1,
                title: "Created a new Mathematics test",
                time: "10 minutes ago",
                icon: "fas fa-plus-circle"
            },
            {
                id: 2,
                title: "Updated Python test questions",
                time: "2 hours ago",
                icon: "fas fa-edit"
            },
            {
                id: 3,
                title: "Added 5 new questions to Science test",
                time: "Yesterday",
                icon: "fas fa-question-circle"
            },
            {
                id: 4,
                title: "Published History test for students",
                time: "2 days ago",
                icon: "fas fa-share"
            },
            {
                id: 5,
                title: "Created a new test template",
                time: "3 days ago",
                icon: "fas fa-layer-group"
            }
        ];

        // DOM Elements
        const paymentSection = document.getElementById('payment-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const createTestSection = document.getElementById('create-test-section');
        const testServicesSection = document.getElementById('test-services-section');
        const templatesSection = document.getElementById('templates-section');
        const pythonServiceSection = document.getElementById('python-service-section');
        const analyticsSection = document.getElementById('analytics-section');
        const settingsSection = document.getElementById('settings-section');

        const navPayment = document.getElementById('nav-payment');
        const navDashboard = document.getElementById('nav-dashboard');
        const navTests = document.getElementById('nav-tests');
        const navTestServices = document.getElementById('nav-test-services');
        const navTemplates = document.getElementById('nav-templates');
        const navPython = document.getElementById('nav-python');
        const navAnalytics = document.getElementById('nav-analytics');
        const navSettings = document.getElementById('nav-settings');

        const makePaymentBtn = document.getElementById('make-payment');
        const testForm = document.getElementById('test-creation-form');
        const accountStatus = document.getElementById('account-status');
        const currentStatus = document.getElementById('current-status');
        const settingsAccountType = document.getElementById('settings-account-type');

        // Test Services Elements
        const coursesContainer = document.getElementById('courses-container');
        const testServicesMainDashboard = document.getElementById('test-services-main-dashboard');
        const testServicesPage = document.getElementById('test-services-page');
        const testServicesContainer = document.getElementById('test-services-container');
        const backToDashboardBtn = document.getElementById('back-to-dashboard');
        const serviceTitle = document.getElementById('service-title');
        const serviceDescription = document.getElementById('service-description');
        const serviceIcon = document.getElementById('service-icon');
        const serviceHeader = document.getElementById('service-header');
        const servicePageTitle = document.getElementById('service-page-title');
        const serviceFooterText = document.getElementById('service-footer-text');

        // Lock overlays
        const dashboardLock = document.getElementById('dashboard-lock');
        const createTestLock = document.getElementById('create-test-lock');
        const testServicesLock = document.getElementById('test-services-lock');
        const templatesLock = document.getElementById('templates-lock');
        const pythonServiceLock = document.getElementById('python-service-lock');
        const analyticsLock = document.getElementById('analytics-lock');
        const settingsLock = document.getElementById('settings-lock');

        // Go to payment buttons
        const gotoPaymentFromDashboard = document.getElementById('goto-payment-from-dashboard');
        const gotoPaymentFromTests = document.getElementById('goto-payment-from-tests');
        const gotoPaymentFromTestServices = document.getElementById('goto-payment-from-test-services');
        const gotoPaymentFromTemplates = document.getElementById('goto-payment-from-templates');
        const gotoPaymentFromPython = document.getElementById('goto-payment-from-python');
        const gotoPaymentFromAnalytics = document.getElementById('goto-payment-from-analytics');
        const gotoPaymentFromSettings = document.getElementById('goto-payment-from-settings');

        // Statistics elements
        const totalTestsElement = document.getElementById('total-tests');
        const totalQuestionsElement = document.getElementById('total-questions');
        const activeTemplatesElement = document.getElementById('active-templates');
        const templateTestCountElement = document.getElementById('template-test-count');
        const templateQuestionCountElement = document.getElementById('template-question-count');
        const templateSubjectCountElement = document.getElementById('template-subject-count');

        // New elements for Create Test Card feature
        const createTestCardBtn = document.getElementById('create-test-card-btn');
        const totalCoursesCountElement = document.getElementById('total-courses-count');
        const footerCoursesCountElement = document.getElementById('footer-courses-count');

        // Quick create elements
        const quickTestNameInput = document.getElementById('quick-test-name');
        const quickSubjectInput = document.getElementById('quick-subject');
        const quickCreateBtn = document.getElementById('quick-create-btn');
        const colorOptions = document.getElementById('color-options');

        // Question management elements
        const manageQuestionsBtn = document.getElementById('manage-questions-btn');
        const questionCountElement = document.getElementById('question-count');
        const questionPreviewElement = document.getElementById('question-preview');
        const createTestModal = document.getElementById('createTestModal');
        const questionListElement = document.getElementById('questionList');
        const questionTypeElement = document.getElementById('questionType');
        const questionTextElement = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const optionsList = document.getElementById('optionsList');
        const addOptionBtn = document.getElementById('addOptionBtn');
        const questionPointsElement = document.getElementById('questionPoints');
        const addQuestionBtn = document.getElementById('addQuestionBtn');
        const saveQuestionsBtn = document.getElementById('saveQuestionsBtn');
        const questionDifficultyElement = document.getElementById('questionDifficulty');

        // Dashboard Animation Elements
        const testsProgress = document.getElementById('tests-progress');
        const questionsProgress = document.getElementById('questions-progress');
        const templatesProgress = document.getElementById('templates-progress');
        const testsProgressValue = document.getElementById('tests-progress-value');
        const questionsProgressValue = document.getElementById('questions-progress-value');
        const templatesProgressValue = document.getElementById('templates-progress-value');
        const testsProgressText = document.getElementById('tests-progress-text');
        const questionsProgressText = document.getElementById('questions-progress-text');
        const templatesProgressText = document.getElementById('templates-progress-text');
        const activityChart = document.getElementById('activity-chart');
        const recentActivityList = document.getElementById('recent-activity-list');

        // Settings elements
        const profileImage = document.getElementById('profile-image');
        const avatarIcon = document.getElementById('avatarIcon');
        const userAvatar = document.getElementById('userAvatar');
        const uploadProfileBtn = document.getElementById('uploadProfileBtn');
        const profilePhotoInput = document.getElementById('profile-photo-input');
        const saveProfileBtn = document.getElementById('save-profile-btn');

        // Mobile sidebar elements
        const toggleBtn = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        // Initialize the app
      function initApp() {
    // Check if payment was previously completed
    const savedPayment = localStorage.getItem('teacherPaymentCompleted');
    if (savedPayment === 'true') {
        state.paymentCompleted = true;
        unlockAllFeatures();
        showDashboard();
    } else {
        lockAllFeatures();
        showPaymentSection();
    }

    // ‚ùå REMOVE old localStorage test loading
    // state.tests = localStorage...

    // Load saved templates
    const savedTemplates = localStorage.getItem('teacherTemplates');
    if (savedTemplates) {
        state.templates = JSON.parse(savedTemplates);
    }

    // Load saved questions
    const savedQuestions = localStorage.getItem('teacherQuestions');
    if (savedQuestions) {
        state.questions = JSON.parse(savedQuestions);
    }

    // Load profile photo
    const savedProfilePhoto = localStorage.getItem('profilePhoto');
    if (savedProfilePhoto) {
        state.profilePhoto = savedProfilePhoto;
        updateProfilePhoto(savedProfilePhoto);
    }

    // Initialize test services
    renderCourses();

    // Set up event listeners
    setupEventListeners();

    // Initialize question management
    initializeQuestionManagement();

    // Initialize recent activity
    renderRecentActivity();

    // Initialize chart
    renderActivityChart();

    // Handle window resize
    window.addEventListener('resize', handleResize);

    // Initialize mobile sidebar
    setupMobileSidebar();

    // ‚úÖ IMPORTANT: Load tests from database
    loadTestsFromDB();
}


        // Update profile photo
        function updateProfilePhoto(photoData) {
            if (photoData) {
                profileImage.src = photoData;
                profileImage.style.display = 'block';

                // Update user avatar in header
                const avatarImg = document.createElement('img');
                avatarImg.src = photoData;
                avatarImg.alt = 'Profile Photo';

                // Clear existing content
                userAvatar.innerHTML = '';
                userAvatar.appendChild(avatarImg);
                avatarIcon.style.display = 'none';
            }
        }

        // Setup mobile sidebar functionality
        function setupMobileSidebar() {
            toggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('show');
                sidebarOverlay.classList.toggle('show');
            });

            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.remove('show');
                sidebarOverlay.classList.remove('show');
            });

            // Close sidebar when clicking on a nav item (mobile)
            document.querySelectorAll('.nav-item a').forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('show');
                        sidebarOverlay.classList.remove('show');
                    }
                });
            });
        }

        // Handle window resize
        function handleResize() {
            // Re-render chart on resize
            if (state.currentSection === 'dashboard-section') {
                renderActivityChart();
            }

            // Close sidebar on desktop
            if (window.innerWidth > 768) {
                sidebar.classList.remove('show');
                sidebarOverlay.classList.remove('show');
            }
        }

        // Initialize question management
        function initializeQuestionManagement() {
            state.currentTestQuestions = [];
            updateQuestionPreview();
        }

        // Render recent activity
        function renderRecentActivity() {
            recentActivityList.innerHTML = '';
            recentActivityData.forEach(activity => {
                const activityItem = document.createElement('li');
                activityItem.className = 'activity-item fade-in-up';
                activityItem.innerHTML = `
                    <div class="activity-icon">
                        <i class="${activity.icon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-time">${activity.time}</div>
                    </div>
                `;
                recentActivityList.appendChild(activityItem);
            });
        }

        // Render activity chart
        function renderActivityChart() {
            // Sample data for the chart
            const chartData = [
                { month: 'Jan', value: 12 },
                { month: 'Feb', value: 19 },
                { month: 'Mar', value: 8 },
                { month: 'Apr', value: 15 },
                { month: 'May', value: 22 },
                { month: 'Jun', value: 18 },
                { month: 'Jul', value: 25 }
            ];

            // Find max value for scaling
            const maxValue = Math.max(...chartData.map(item => item.value));

            activityChart.innerHTML = '';

            chartData.forEach((item, index) => {
                // Calculate height as percentage of max value
                const heightPercentage = (item.value / maxValue) * 100;

                const chartBar = document.createElement('div');
                chartBar.className = 'chart-bar';
                chartBar.style.height = `${heightPercentage}%`;
                chartBar.style.animationDelay = `${index * 0.1}s`;

                chartBar.innerHTML = `
                    <div class="chart-value">${item.value}</div>
                    <div class="chart-label">${item.month}</div>
                `;

                activityChart.appendChild(chartBar);
            });
        }

        // Lock all features (payment not completed)
        function lockAllFeatures() {
            // Update UI to show locked state
            accountStatus.textContent = "Free Account";
            currentStatus.textContent = "Free Account (Limited Features)";
            settingsAccountType.textContent = "Free Account";
            currentStatus.style.color = "#e74c3c";

            // Show lock overlays
            if (dashboardLock) dashboardLock.style.display = 'flex';
            if (createTestLock) createTestLock.style.display = 'flex';
            if (testServicesLock) testServicesLock.style.display = 'flex';
            if (templatesLock) templatesLock.style.display = 'flex';
            if (pythonServiceLock) pythonServiceLock.style.display = 'flex';
            if (analyticsLock) analyticsLock.style.display = 'flex';
            if (settingsLock) settingsLock.style.display = 'flex';

            // Disable all form elements
            disableFormElements();

            // Update navigation items to show locked state
            document.querySelectorAll('.nav-item:not(#nav-payment)').forEach(item => {
                item.classList.add('locked');
                const lockIcon = item.querySelector('.lock-icon');
                if (lockIcon) lockIcon.style.display = 'block';
            });

            // Enable only payment navigation
            navPayment.classList.remove('locked');
            navPayment.classList.add('active');
        }

        // Unlock all features (payment completed)
        function unlockAllFeatures() {
            // Update UI to show unlocked state
            accountStatus.textContent = "Premium Account";
            accountStatus.style.color = "#27ae60";
            currentStatus.textContent = "Premium Account (All Features Unlocked)";
            settingsAccountType.textContent = "Premium Account";
            currentStatus.style.color = "#27ae60";

            // Hide lock overlays
            if (dashboardLock) dashboardLock.style.display = 'none';
            if (createTestLock) createTestLock.style.display = 'none';
            if (testServicesLock) testServicesLock.style.display = 'none';
            if (templatesLock) templatesLock.style.display = 'none';
            if (pythonServiceLock) pythonServiceLock.style.display = 'none';
            if (analyticsLock) analyticsLock.style.display = 'none';
            if (settingsLock) settingsLock.style.display = 'none';

            // Enable all form elements
            enableFormElements();

            // Update navigation items to show unlocked state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('locked');
                const lockIcon = item.querySelector('.lock-icon');
                if (lockIcon) lockIcon.style.display = 'none';
            });

            // Show success notification
            showNotification('All features unlocked successfully!', 'success');
        }

        // Disable all form elements
        function disableFormElements() {
            // Disable test form inputs
            document.querySelectorAll('#test-creation-form input, #test-creation-form select, #test-creation-form textarea').forEach(el => {
                el.disabled = true;
            });

            // Disable quick create inputs
            quickTestNameInput.disabled = true;
            quickSubjectInput.disabled = true;
            quickCreateBtn.disabled = true;
            quickCreateBtn.classList.add('disabled');

            // Disable buttons
            document.querySelectorAll('#test-creation-form button, #refresh-tests, #view-all-tests').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('disabled');
            });

            // Disable settings elements
            uploadProfileBtn.disabled = true;
            document.querySelectorAll('#settings-section input, #settings-section select').forEach(el => {
                el.disabled = true;
            });
            saveProfileBtn.disabled = true;
        }

        // Enable all form elements
        function enableFormElements() {
            // Enable test form inputs
            document.querySelectorAll('#test-creation-form input, #test-creation-form select, #test-creation-form textarea').forEach(el => {
                el.disabled = false;
            });

            // Enable quick create inputs
            quickTestNameInput.disabled = false;
            quickSubjectInput.disabled = false;
            quickCreateBtn.disabled = false;
            quickCreateBtn.classList.remove('disabled');

            // Enable buttons
            document.querySelectorAll('#test-creation-form button, #refresh-tests, #view-all-tests').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('disabled');
            });

            // Enable question management button
            manageQuestionsBtn.disabled = false;
            manageQuestionsBtn.style.backgroundColor = '#3498db';
            manageQuestionsBtn.style.color = 'white';
            manageQuestionsBtn.onclick = openQuestionModal;

            // Enable settings elements
            uploadProfileBtn.disabled = false;
            document.querySelectorAll('#settings-section input, #settings-section select').forEach(el => {
                el.disabled = false;
            });
            saveProfileBtn.disabled = false;
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Navigation - with payment check
            navPayment.addEventListener('click', () => showPaymentSection());

            navDashboard.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showDashboard();
                } else {
                    alert('Please complete payment first to access the dashboard.');
                    showPaymentSection();
                }
            });

            navTests.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showCreateTestSection();
                } else {
                    alert('Please complete payment first to create tests.');
                    showPaymentSection();
                }
            });

            navTestServices.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showTestServicesSection();
                } else {
                    alert('Please complete payment first to access Test Services.');
                    showPaymentSection();
                }
            });

            navTemplates.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showTemplatesSection();
                } else {
                    alert('Please complete payment first to access templates.');
                    showPaymentSection();
                }
            });

            navPython.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showPythonServiceSection();
                } else {
                    alert('Please complete payment first to access Python Test Service.');
                    showPaymentSection();
                }
            });

            navAnalytics.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showAnalyticsSection();
                } else {
                    alert('Please complete payment first to access Analytics.');
                    showPaymentSection();
                }
            });

            navSettings.addEventListener('click', () => {
                if (state.paymentCompleted) {
                    showSettingsSection();
                } else {
                    alert('Please complete payment first to access Settings.');
                    showPaymentSection();
                }
            });

            // Payment
            makePaymentBtn.addEventListener('click', processPayment);

            // Go to payment buttons
            gotoPaymentFromDashboard.addEventListener('click', () => showPaymentSection());
            gotoPaymentFromTests.addEventListener('click', () => showPaymentSection());
            gotoPaymentFromTestServices.addEventListener('click', () => showPaymentSection());
            gotoPaymentFromTemplates.addEventListener('click', () => showPaymentSection());
            gotoPaymentFromPython.addEventListener('click', () => showPaymentSection());
            gotoPaymentFromAnalytics.addEventListener('click', () => showPaymentSection());
            gotoPaymentFromSettings.addEventListener('click', () => showPaymentSection());

            // Test form - only if payment completed
            testForm.addEventListener('submit', function (e) {
                e.preventDefault();
                if (state.paymentCompleted) {
                    createTest(e);
                } else {
                    alert('Please complete payment first to create tests.');
                    showPaymentSection();
                }
            });

            document.getElementById('reset-form').addEventListener('click', function () {
                if (state.paymentCompleted) {
                    resetTestForm();
                } else {
                    alert('Please complete payment first to use this feature.');
                }
            });

            // Create Test Card button
            createTestCardBtn.addEventListener('click', function () {
                if (state.paymentCompleted) {
                    createTestCardFromForm();
                } else {
                    alert('Please complete payment first to create test cards.');
                    showPaymentSection();
                }
            });

            // Quick Create button
            quickCreateBtn.addEventListener('click', function () {
                if (state.paymentCompleted) {
                    createQuickTestCard();
                } else {
                    alert('Please complete payment first to create test cards.');
                    showPaymentSection();
                }
            });

            // Color selection
            colorOptions.addEventListener('click', function (e) {
                if (e.target.classList.contains('color-option')) {
                    // Remove selected class from all color options
                    document.querySelectorAll('.color-option').forEach(option => {
                        option.classList.remove('selected');
                    });

                    // Add selected class to clicked option
                    e.target.classList.add('selected');

                    // Update selected color
                    state.selectedColor = e.target.getAttribute('data-color');
                }
            });

            // Test Services back button
            backToDashboardBtn.addEventListener('click', function () {
                testServicesMainDashboard.style.display = 'block';
                testServicesPage.style.display = 'none';
            });

            // Test Services details buttons (event delegation)
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('details-btn') || e.target.closest('.details-btn')) {
                    if (!state.paymentCompleted) {
                        alert('Please complete payment first to access Test Services.');
                        showPaymentSection();
                        return;
                    }

                    const button = e.target.classList.contains('details-btn') ? e.target : e.target.closest('.details-btn');
                    const courseName = button.getAttribute('data-course');
                    showTestServicesPage(courseName);
                }

                // Enroll buttons
                if (e.target.classList.contains('enroll-btn') || e.target.closest('.enroll-btn')) {
                    const button = e.target.classList.contains('enroll-btn') ? e.target : e.target.closest('.enroll-btn');
                    const card = button.closest('.test-service-card');
                    const testName = card.querySelector('.test-service-name').textContent;
                    alert(`Starting test: ${testName}\n\nGood luck! The test will begin shortly.`);
                }
            });

            // Question Management
            addQuestionBtn.addEventListener('click', addQuestion);
            saveQuestionsBtn.addEventListener('click', saveQuestions);
            addOptionBtn.addEventListener('click', addOption);
            questionTypeElement.addEventListener('change', handleQuestionTypeChange);

            // Profile photo upload
            uploadProfileBtn.addEventListener('click', () => {
                profilePhotoInput.click();
            });

            profilePhotoInput.addEventListener('change', handleProfilePhotoUpload);
            saveProfileBtn.addEventListener('click', saveProfileSettings);

            // Modal close on outside click
            window.addEventListener('click', function (e) {
                if (e.target === createTestModal) {
                    closeModal('createTestModal');
                }
            });

            // Top navbar elements
            const topNavPayment = document.getElementById('top-nav-payment');
            const topNavDashboard = document.getElementById('top-nav-dashboard');
            const topNavTests = document.getElementById('top-nav-tests');
            const topNavTemplates = document.getElementById('top-nav-templates');
            const topNavServices = document.getElementById('top-nav-services');
            const topNavPython = document.getElementById('top-nav-python');
            const topNavSettings = document.getElementById('top-nav-settings');

            // Same actions as sidebar
            topNavPayment.addEventListener('click', () => showPaymentSection());
            topNavDashboard.addEventListener('click', () => navDashboard.click());
            topNavTests.addEventListener('click', () => navTests.click());
            topNavTemplates.addEventListener('click', () => navTemplates.click());
            topNavServices.addEventListener('click', () => navTestServices.click());
            topNavPython.addEventListener('click', () => navPython.click());
            topNavSettings.addEventListener('click', () => navSettings.click());
        }

        // Handle profile photo upload
        function handleProfilePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Check if file is an image
            if (!file.type.match('image.*')) {
                alert('Please select an image file.');
                return;
            }

            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size should be less than 5MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                const photoData = event.target.result;
                state.profilePhoto = photoData;

                // Update UI
                updateProfilePhoto(photoData);

                // Save to localStorage
                localStorage.setItem('profilePhoto', photoData);

                showNotification('Profile photo updated successfully!', 'success');
            };

            reader.readAsDataURL(file);
        }

        // Save profile settings
        function saveProfileSettings() {
            // In a real app, you would send this to a server
            showNotification('Profile settings saved successfully!', 'success');
        }

        // Show notification
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div style="position: fixed; top: 80px; right: 20px; left: 20px; background-color: ${type === 'success' ? '#27ae60' : '#3498db'}; color: white; padding: 12px 15px; border-radius: 5px; box-shadow: 0 3px 10px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 10px; font-size: 0.9rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Show payment section
        function showPaymentSection() {
            hideAllSections();
            paymentSection.classList.remove('hidden');
            updateActiveNav('nav-payment');
            state.currentSection = 'payment-section';
        }

        // Show dashboard section with animations
        function showDashboard() {
            hideAllSections();
            dashboardSection.classList.remove('hidden');
            updateActiveNav('nav-dashboard');
            state.currentSection = 'dashboard-section';

            // Update dashboard stats
            updateDashboard();

            // Play dashboard animations if not already played
            if (!state.dashboardAnimationsPlayed) {
                setTimeout(() => {
                    animateDashboard();
                    state.dashboardAnimationsPlayed = true;
                }, 300);
            }
        }

        // Show create test section
        function showCreateTestSection() {
            hideAllSections();
            createTestSection.classList.remove('hidden');
            updateActiveNav('nav-tests');
            state.currentSection = 'create-test-section';
        }

        // Show test services section
        function showTestServicesSection() {
            hideAllSections();
            testServicesSection.classList.remove('hidden');
            updateActiveNav('nav-test-services');
            state.currentSection = 'test-services-section';

            // Ensure test services dashboard is visible
            testServicesMainDashboard.style.display = 'block';
            testServicesPage.style.display = 'none';
        }

        // Show templates section
        function showTemplatesSection() {
            hideAllSections();
            templatesSection.classList.remove('hidden');
            updateActiveNav('nav-templates');
            state.currentSection = 'templates-section';
        }

        // Show Python service section
        function showPythonServiceSection() {
            hideAllSections();
            pythonServiceSection.classList.remove('hidden');
            updateActiveNav('nav-python');
            state.currentSection = 'python-service-section';
        }

        // Show analytics section
        function showAnalyticsSection() {
            hideAllSections();
            analyticsSection.classList.remove('hidden');
            updateActiveNav('nav-analytics');
            state.currentSection = 'analytics-section';
        }

        // Show settings section
        function showSettingsSection() {
            hideAllSections();
            settingsSection.classList.remove('hidden');
            updateActiveNav('nav-settings');
            state.currentSection = 'settings-section';
        }

        // Hide all sections
        function hideAllSections() {
            paymentSection.classList.add('hidden');
            dashboardSection.classList.add('hidden');
            createTestSection.classList.add('hidden');
            testServicesSection.classList.add('hidden');
            templatesSection.classList.add('hidden');
            pythonServiceSection.classList.add('hidden');
            analyticsSection.classList.add('hidden');
            settingsSection.classList.add('hidden');
        }

        // Update active navigation item
        function updateActiveNav(activeId) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to current nav item
            const activeNav = document.getElementById(activeId);
            if (activeNav) {
                activeNav.classList.add('active');
            }

            // Update top navbar active state
            document.querySelectorAll('.top-navbar a').forEach(link => {
                link.classList.remove('active');
            });

            // Find and activate corresponding top navbar link
            const topNavId = activeId.replace('nav-', 'top-nav-');
            const topNavLink = document.getElementById(topNavId);
            if (topNavLink) {
                topNavLink.classList.add('active');
            }
        }

        // Animate dashboard elements
        function animateDashboard() {
            // Update progress bars with animation
            const testsCount = state.tests.length;
            const questionsCount = state.tests.reduce((total, test) => total + (test.questions ? test.questions.length : 0), 0);
            const templatesCount = state.templates.length;

            // Set target values for progress bars
            const testsTarget = 50;
            const questionsTarget = 200;
            const templatesTarget = 10;

            // Calculate percentages
            const testsPercentage = Math.min((testsCount / testsTarget) * 100, 100);
            const questionsPercentage = Math.min((questionsCount / questionsTarget) * 100, 100);
            const templatesPercentage = Math.min((templatesCount / templatesTarget) * 100, 100);

            // Animate progress bars
            animateProgressBar(testsProgress, testsPercentage, testsProgressValue, testsProgressText);
            animateProgressBar(questionsProgress, questionsPercentage, questionsProgressValue, questionsProgressText);
            animateProgressBar(templatesProgress, templatesPercentage, templatesProgressValue, templatesProgressText);

            // Animate stat numbers
            animateCounter(totalTestsElement, testsCount);
            animateCounter(totalQuestionsElement, questionsCount);
            animateCounter(activeTemplatesElement, templatesCount);
        }

        // Animate progress bar
        function animateProgressBar(progressBar, percentage, valueElement, textElement) {
            // Set CSS custom property for animation
            progressBar.style.width = `${percentage}%`;

            // Update text elements
            valueElement.textContent = `${Math.round(percentage)}%`;
            textElement.textContent = `${Math.round(percentage)}%`;

            // Trigger animation
            progressBar.style.transition = 'width 1.5s ease-in-out';
        }

        // Animate counter
        function animateCounter(element, targetValue) {
            const duration = 1500; // ms
            const step = targetValue / (duration / 16); // 60fps
            let current = 0;

            const timer = setInterval(() => {
                current += step;
                if (current >= targetValue) {
                    current = targetValue;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }

        // Process payment
        function processPayment() {
            // Simulate payment processing
            makePaymentBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Payment...';
            makePaymentBtn.disabled = true;

            setTimeout(() => {
                // Payment successful
                state.paymentCompleted = true;
                localStorage.setItem('teacherPaymentCompleted', 'true');

                makePaymentBtn.innerHTML = '<i class="fas fa-check"></i> Payment Successful!';
                makePaymentBtn.style.background = 'linear-gradient(90deg, #27ae60, #2ecc71)';

                // Unlock all features
                unlockAllFeatures();

                // Directly show dashboard
                showDashboard();

            }, 1500);
        }


        // Open question modal
        function openQuestionModal() {
            createTestModal.style.display = 'flex';
            renderQuestionList();
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Handle question type change
        function handleQuestionTypeChange() {
            const questionType = questionTypeElement.value;

            if (questionType === 'multiple-choice') {
                optionsContainer.style.display = 'block';

                // Reset to default 4 options
                optionsList.innerHTML = `
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="0">
                        <input type="text" class="form-control" placeholder="Option 1">
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="1">
                        <input type="text" class="form-control" placeholder="Option 2">
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="2">
                        <input type="text" class="form-control" placeholder="Option 3">
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="3">
                        <input type="text" class="form-control" placeholder="Option 4">
                    </div>
                `;
            }

            else if (questionType === 'true-false') {
                optionsContainer.style.display = 'block';
                optionsList.innerHTML = `
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="true">
                        <input type="text" class="form-control" value="True" readonly>
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="false">
                        <input type="text" class="form-control" value="False" readonly>
                    </div>
                `;
            }

            else {
                optionsContainer.style.display = 'none';
            }
        }

        // Add option for MCQ
        function addOption() {
            const optionCount = optionsList.children.length;
            const optionNumber = optionCount + 1;

            const optionDiv = document.createElement('div');
            optionDiv.className = 'question-option-input';
            optionDiv.innerHTML = `
                <input type="radio" name="correctOption" value="${optionCount}">
                <input type="text" class="form-control" placeholder="Option ${optionNumber}">
                <button type="button" class="btn btn-sm" onclick="removeOption(this)" style="background-color: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;

            optionsList.appendChild(optionDiv);
        }

        // Remove option
        function removeOption(button) {
            const optionDiv = button.parentElement;

            // Minimum 2 options required
            if (optionsList.children.length > 2) {
                optionDiv.remove();

                // Reassign values and placeholders
                Array.from(optionsList.children).forEach((div, index) => {
                    const radio = div.querySelector('input[type="radio"]');
                    radio.value = index;

                    const input = div.querySelector('input[type="text"]');
                    input.placeholder = `Option ${index + 1}`;
                });
            } else {
                alert('At least 2 options are required for MCQ questions.');
            }
        }

        // Add question
        function addQuestion() {
            const questionText = questionTextElement.value.trim();
            const questionType = questionTypeElement.value;
            const points = parseInt(questionPointsElement.value);
            const difficulty = questionDifficultyElement.value;

            if (!questionText) {
                alert('Please enter question text.');
                return;
            }

            let question = {
                id: Date.now(),
                text: questionText,
                type: questionType,
                points: points,
                difficulty: difficulty
            };

            if (questionType === 'multiple-choice') {
                const options = [];
                const optionInputs = optionsList.querySelectorAll('input[type="text"]');
                const correctOption = document.querySelector('input[name="correctOption"]:checked');

                if (!correctOption) {
                    alert('Please select the correct answer.');
                    return;
                }

                optionInputs.forEach((input, index) => {
                    if (input.value.trim()) {
                        options.push({
                            id: index,
                            text: input.value.trim(),
                            isCorrect: index === parseInt(correctOption.value)
                        });
                    }
                });

                if (options.length < 2) {
                    alert('Please add at least 2 options for MCQ.');
                    return;
                }

                question.options = options;
                question.correctAnswer = parseInt(correctOption.value);
            } else if (questionType === 'true-false') {
                const correctOption = document.querySelector('input[name="correctOption"]:checked');
                if (!correctOption) {
                    alert('Please select the correct answer (True or False).');
                    return;
                }
                question.correctAnswer = correctOption.value === 'true';
                question.options = [
                    { id: 0, text: 'True', isCorrect: correctOption.value === 'true' },
                    { id: 1, text: 'False', isCorrect: correctOption.value === 'false' }
                ];
            } else {
                // Short answer - no options needed
                question.correctAnswer = ''; // Will be set by teacher when grading
            }

            state.currentTestQuestions.push(question);
            renderQuestionList();
            updateQuestionPreview();

            // Reset form
            questionTextElement.value = '';
            questionPointsElement.value = '1';
            questionTypeElement.value = 'multiple-choice';
            handleQuestionTypeChange();

            // Reset options for MCQ
            if (questionType === 'multiple-choice') {
                optionsList.innerHTML = `
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="0">
                        <input type="text" class="form-control" placeholder="Option A" id="option0">
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="1">
                        <input type="text" class="form-control" placeholder="Option B" id="option1">
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="2">
                        <input type="text" class="form-control" placeholder="Option C" id="option2">
                    </div>
                    <div class="question-option-input">
                        <input type="radio" name="correctOption" value="3">
                        <input type="text" class="form-control" placeholder="Option D" id="option3">
                    </div>
                `;
            }

            showNotification('Question added successfully!', 'success');
        }

        // Render question list
        function renderQuestionList() {
            if (state.currentTestQuestions.length === 0) {
                questionListElement.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-question-circle"></i>
                        <p>No questions added yet. Add your first question below.</p>
                    </div>
                `;
                return;
            }

            questionListElement.innerHTML = '';
            state.currentTestQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <div class="question-text">Q${index + 1}: ${question.text}</div>
                        <div class="question-type">${question.type.toUpperCase()}</div>
                    </div>
                    ${question.options ? `
                        <div class="question-options">
                            ${question.options.map(option => `
                                <div class="question-option ${option.isCorrect ? 'correct' : ''}">
                                    ${String.fromCharCode(65 + option.id)}. ${option.text}
                                    ${option.isCorrect ? ' <i class="fas fa-check" style="color: #27ae60;"></i>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    <div class="question-marks">
                        Marks: ${question.points} | Difficulty: ${question.difficulty}
                    </div>
                    <button onclick="removeQuestion(${question.id})" style="margin-top: 10px; background-color: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                `;
                questionListElement.appendChild(questionDiv);
            });
        }

        // Remove question
        function removeQuestion(questionId) {
            state.currentTestQuestions = state.currentTestQuestions.filter(q => q.id !== questionId);
            renderQuestionList();
            updateQuestionPreview();
            showNotification('Question removed.', 'info');
        }

        // Update question preview
        function updateQuestionPreview() {
            const count = state.currentTestQuestions.length;
            questionCountElement.textContent = count;

            if (count === 0) {
                questionPreviewElement.innerHTML = '<p style="color: #7f8c8d; text-align: center;">No questions added yet.</p>';
                return;
            }

            let previewHTML = '';
            state.currentTestQuestions.slice(0, 3).forEach((question, index) => {
                previewHTML += `
                    <div style="margin-bottom: 10px; padding: 10px; border-bottom: 1px solid #eee;">
                        <strong>Q${index + 1}:</strong> ${question.text.substring(0, 50)}${question.text.length > 50 ? '...' : ''}
                        <div style="font-size: 0.8rem; color: #7f8c8d;">
                            Type: ${question.type} | Marks: ${question.points}
                        </div>
                    </div>
                `;
            });

            if (count > 3) {
                previewHTML += `<div style="text-align: center; color: #3498db; font-weight: 600;">
                    +${count - 3} more questions
                </div>`;
            }

            questionPreviewElement.innerHTML = previewHTML;
        }

        // Save questions
        function saveQuestions() {
            if (state.currentTestQuestions.length === 0) {
                alert('Please add at least one question before saving.');
                return;
            }

            // Save questions to localStorage
            localStorage.setItem('currentTestQuestions', JSON.stringify(state.currentTestQuestions));

            closeModal('createTestModal');
            showNotification(`Saved ${state.currentTestQuestions.length} questions successfully!`, 'success');
        }

        // Create a new test
        async function createTest(e) {
    e.preventDefault();

    if (!state.paymentCompleted) {
        alert('Please complete payment first to create tests.');
        showPaymentSection();
        return;
    }

    const testName = document.getElementById('test-name').value;
    const testSubject = document.getElementById('test-subject').value;
    const testDuration = document.getElementById('test-duration').value;
    const testDifficulty = document.getElementById('test-difficulty').value;
    const testDescription = document.getElementById('test-description').value;

    if (!testSubject) {
        alert('Please enter a subject.');
        return;
    }

    if (state.currentTestQuestions.length === 0) {
        alert('Please add questions to the test.');
        openQuestionModal();
        return;
    }

    const testData = {
        name: testName,
        subject: testSubject,
        duration: testDuration,
        difficulty: testDifficulty,
        description: testDescription,
        questions: state.currentTestQuestions
    };

    try {
        const res = await fetch("/api/teacher-tests/create-test", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(testData)
        });

        const data = await res.json();

        if (!data.success) {
            alert("Error saving test.");
            return;
        }

        // Reset form
        resetTestForm();

        // ‚úÖ Reload from database
        await loadTestsFromDB();

        // Update dashboard
        updateDashboard();

        showNotification(`Test "${testName}" created successfully!`, 'success');

    } catch (err) {
        console.error(err);
        alert("Server error while saving test.");
    }
}


        // Create test card from form data
        function createTestCardFromForm() {
            const testName = document.getElementById('test-name').value;
            const testSubject = document.getElementById('test-subject').value;
            const testDuration = document.getElementById('test-duration').value;
            const testDifficulty = document.getElementById('test-difficulty').value;
            const testDescription = document.getElementById('test-description').value;

            if (!testName || !testSubject) {
                alert('Please fill in test name and subject.');
                return;
            }

            // Create test object
            const test = {
                id: Date.now(),
                name: testName,
                subject: testSubject,
                duration: testDuration,
                difficulty: testDifficulty,
                description: testDescription,
                questions: state.currentTestQuestions,
                totalQuestions: state.currentTestQuestions.length,
                totalMarks: state.currentTestQuestions.reduce((sum, q) => sum + q.points, 0)
            };

            createTestCardFromTest(test);
        }

        // Create test card from test object
        function createTestCardFromTest(test) {
    // ‚ùå This function is no longer needed
    // because cards are created from database

    console.log("Card creation handled by DB loader");
}

        // Create quick test card
        function createQuickTestCard() {
    alert("Quick create is disabled. Please create full test so it saves in database.");
}


        function findCourseBySubject(subject) {
            return coursesData.find(course =>
                course.title.toLowerCase() === subject.toLowerCase()
            );
        }

        
        // Get random color
        function getRandomColor() {
            const colors = [
                "#e34f26", "#1572b6", "#f7df1e", "#339933",
                "#3776ab", "#777bb4", "#4479a1", "#47a248",
                "#9b59b6", "#e74c3c", "#1abc9c", "#3498db",
                "#f39c12", "#d35400", "#c0392b", "#8e44ad"
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Get icon for subject
        function getIconForSubject(subject) {
            // Check if subject matches any predefined ones
            const subjectLower = subject.toLowerCase();
            if (subjectLower.includes('html')) return 'fab fa-html5';
            if (subjectLower.includes('css')) return 'fab fa-css3-alt';
            if (subjectLower.includes('javascript') || subjectLower.includes('js')) return 'fab fa-js';
            if (subjectLower.includes('python')) return 'fab fa-python';
            if (subjectLower.includes('php')) return 'fab fa-php';
            if (subjectLower.includes('mysql')) return 'fas fa-database';
            if (subjectLower.includes('node')) return 'fab fa-node-js';
            if (subjectLower.includes('mongo')) return 'fas fa-server';
            if (subjectLower.includes('math')) return 'fas fa-calculator';
            if (subjectLower.includes('science')) return 'fas fa-flask';
            if (subjectLower.includes('history')) return 'fas fa-landmark';
            if (subjectLower.includes('english')) return 'fas fa-book';
            if (subjectLower.includes('computer')) return 'fas fa-laptop-code';

            // Default icon
            return 'fas fa-file-alt';
        }

        // Get level class for difficulty
        function getLevelClass(difficulty) {
            const levelMap = {
                'Beginner': 'level-beginner',
                'Intermediate': 'level-intermediate',
                'Advanced': 'level-advanced'
            };

            return levelMap[difficulty] || 'level-intermediate';
        }

        // Update course count
        function updateCourseCount() {
            const count = coursesData.length;
            totalCoursesCountElement.textContent = count;
            footerCoursesCountElement.textContent = count;
        }

        // Reset the test form
        function resetTestForm() {
            if (!state.paymentCompleted) {
                alert('Please complete payment first to use this feature.');
                return;
            }

            testForm.reset();
            document.getElementById('test-duration').value = 60;
            document.getElementById('test-difficulty').value = 'Intermediate';

            // Reset questions
            state.currentTestQuestions = [];
            updateQuestionPreview();
        }

        // Update dashboard
        function updateDashboard() {
            // Update statistics
            totalTestsElement.textContent = state.tests.length;

            const totalQuestions = state.tests.reduce((total, test) => total + (test.questions ? test.questions.length : 0), 0);
            totalQuestionsElement.textContent = totalQuestions;

            const activeTemplates = state.templates.filter(t => t.active).length;
            activeTemplatesElement.textContent = activeTemplates;

            // Update dashboard animations if dashboard is visible
            if (state.currentSection === 'dashboard-section') {
                animateDashboard();
            }
        }

        // Render all courses
        function renderCourses() {
            coursesContainer.innerHTML = '';

            coursesData.forEach(course => {

                // Get real question count from services
                let questionCount = 0;
                if (testServicesData[course.title]) {
                    questionCount = testServicesData[course.title]
                        .reduce((sum, service) => sum + (service.questions || 0), 0);
                }

                const courseCard = document.createElement('div');
                courseCard.className = 'course-card';

                courseCard.innerHTML = `
            <div class="course-card-header" style="background: linear-gradient(135deg, ${course.color}, #2c3e50);">
                <div class="card-icon">
                    <i class="${course.icon}"></i>
                </div>
                <h2 class="card-title">${course.title}</h2>
                <p class="card-subtitle">${course.subtitle}</p>
            </div>
            <div class="course-card-body">
                <div class="viewers-count">
                    <i class="fas fa-eye"></i>
                    <span>Updated Viewers: ${course.viewers}</span>
                </div>
                <div class="level-badge ${course.levelClass}">
                    ${course.level}
                </div>
                <p style="color: #7f8c8d; text-align: center; line-height: 1.5;">
                    ${course.description}
                </p>
                <div class="test-questions">
                    <i class="fas fa-question-circle"></i>
                    ${questionCount} Questions
                </div>
            </div>
            <div class="course-card-footer">
                <button class="details-btn" data-course="${course.title}">
                    <i class="fas fa-info-circle"></i> More Details
                </button>
            </div>
            ${questionCount > 0 ? `<div class="question-count">${questionCount} Q</div>` : ''}
        `;

                coursesContainer.appendChild(courseCard);
            });

            updateCourseCount();
        }

        // Render test services for a specific course
        function renderTestServices(courseName) {
            testServicesContainer.innerHTML = '';

            const services = testServicesData[courseName];

            if (!services || services.length === 0) {
                testServicesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>No Test Services Available</h3>
                        <p>There are currently no test services for ${courseName}.</p>
                        <p>Check back soon for updates!</p>
                    </div>
                `;
                return;
            }

            services.forEach(service => {
                const serviceCard = document.createElement('div');
                serviceCard.className = 'test-service-card';
                serviceCard.innerHTML = `
                    <div class="test-service-header" style="background: linear-gradient(135deg, ${service.color}, #2980b9);">
                        <div class="test-service-icon">
                            <i class="${service.icon}"></i>
                        </div>
                        <h2 class="test-service-name">${service.name}</h2>
                        <p class="test-service-type">${service.type}</p>
                    </div>
                    <div class="test-service-body">
                        <div class="test-service-level ${service.levelClass}">
                            ${service.level} Level
                        </div>
                        <p class="test-service-description">
                            ${service.description}
                        </p>
                        <div class="test-service-stats">
                            <div class="stat-item">
                                <div class="stat-value">${service.questions}</div>
                                <div class="stat-label">Questions</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${service.duration}</div>
                                <div class="stat-label">Duration</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${service.students}</div>
                                <div class="stat-label">Students</div>
                            </div>
                        </div>
                    </div>
                    <div class="test-service-footer">
                        <button class="enroll-btn" style="background: linear-gradient(90deg, #27ae60, #2ecc71);">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                        <button class="enroll-btn" style="background: linear-gradient(90deg, #3498db, #2980b9);">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="enroll-btn" style="background: linear-gradient(90deg, #f39c12, #e67e22);">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="enroll-btn" style="background: linear-gradient(90deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-chart-bar"></i> Result
                        </button>
                    </div>
                `;

                testServicesContainer.appendChild(serviceCard);
            });

            // Update footer text
            serviceFooterText.textContent = `${services.length} Test Services for ${courseName}`;
        }

        // Show test services page for a specific course
        function showTestServicesPage(courseName) {
            // Find course data
            const course = coursesData.find(c => c.title === courseName);

            if (!course) return;

            // Update page content
            serviceTitle.textContent = `${courseName} Test Services`;
            serviceDescription.textContent = `Explore all ${testServicesData[courseName]?.length || 0} test services available for ${courseName}. From beginner to advanced level tests.`;
            serviceIcon.innerHTML = `<i class="${course.icon}"></i>`;
            serviceHeader.style.background = `linear-gradient(135deg, ${course.color}, #8e44ad)`;
            servicePageTitle.textContent = `${courseName} Test Services`;

            // Render test services
            renderTestServices(courseName);

            // Show test services page, hide main dashboard
            testServicesMainDashboard.style.display = 'none';
            testServicesPage.style.display = 'block';

            // Scroll to top on mobile
            if (window.innerWidth <= 768) {
                document.querySelector('.page-content-wrapper').scrollTop = 0;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', initApp);

        // Universal translator (question + all options)
        async function translateAuto() {
            const questionText = questionTextElement.value.trim();
            const optionInputs = optionsList.querySelectorAll('input[type="text"]');

            if (!questionText && optionInputs.length === 0) {
                alert("Nothing to translate.");
                return;
            }

            // Detect Hindi or English
            function detectLanguage(text) {
                const hindiRegex = /[\u0900-\u097F]/; // Hindi unicode range
                return hindiRegex.test(text) ? "hi" : "en";
            }

            async function translateText(text, from, to) {
                const res = await fetch(
                    `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`
                );
                const data = await res.json();

                if (data && data.responseData && data.responseData.translatedText) {
                    return data.responseData.translatedText;
                }
                return text;
            }

            try {
                if (questionText) {
                    const fromLang = detectLanguage(questionText);
                    const toLang = fromLang === "en" ? "hi" : "en";

                    const lines = questionText.split("\n");
                    const translatedLines = [];

                    for (let line of lines) {
                        if (line.trim() === "") {
                            translatedLines.push("");
                            continue;
                        }
                        const translated = await translateText(line, fromLang, toLang);
                        translatedLines.push(translated);
                    }

                    questionTextElement.value = translatedLines.join("\n");

                    // Translate options also
                    for (let input of optionInputs) {
                        const text = input.value.trim();
                        if (!text) continue;

                        const translated = await translateText(text, fromLang, toLang);
                        input.value = translated;
                    }
                }

            } catch (error) {
                console.error(error);
                alert("Translation error. Check internet connection.");
            }
        }
        async function loadTestsFromDB() {
            try {
                const res = await fetch("/api/teacher-tests/my-tests");
                const tests = await res.json();

                coursesData.length = 0;
                Object.keys(testServicesData).forEach(k => delete testServicesData[k]);

                const subjectsMap = {};

                tests.forEach(test => {
                    if (!subjectsMap[test.subject]) {
                        subjectsMap[test.subject] = {
                            id: Date.now() + Math.random(),
                            title: test.subject,
                            subtitle: test.name,
                            icon: getIconForSubject(test.subject),
                            color: getRandomColor(),
                            viewers: 1,
                            level: test.difficulty,
                            levelClass: getLevelClass(test.difficulty),
                            description: test.description || `Test for ${test.subject}`
                        };

                        coursesData.push(subjectsMap[test.subject]);
                        testServicesData[test.subject] = [];
                    }

                    testServicesData[test.subject].push({
                        id: test._id,
                        name: test.name,
                        type: test.difficulty,
                        icon: getIconForSubject(test.subject),
                        level: test.difficulty,
                        levelClass: getLevelClass(test.difficulty),
                        description: test.description,
                        questions: test.questions.length,
                        duration: test.duration + " min",
                        students: 0,
                        color: subjectsMap[test.subject].color
                    });
                });

                renderCourses();
                updateCourseCount();

            } catch (err) {
                console.error("Error loading tests:", err);
            }
        }


    </script>
</body>

</html>