<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>paperHive · creative research library</title>
  <!-- Google Font + Font Awesome 6 (free) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
 <link rel="stylesheet" href="/css/Research-paper/index.css">
</head>
<body>
  <div class="library-container">
    <!-- header with creative flair -->
    <header class="top-header">
      <div class="logo-area">
        <div class="logo-icon"><i class="fas fa-bolt"></i></div>
        <div class="logo-text">
          <h1>paperHive <span style="display: inline; font-size: 0.9rem; background: none; -webkit-text-fill-color: #6b81b0;">✦</span></h1>
          <span>research library · interactive</span>
        </div>
      </div>
      <div class="user-badge">
        <i class="fa-regular fa-bell"></i>
        <span>4 updates</span>
        <div class="avatar"><i class="fa-regular fa-user"></i>  researcher</div>
      </div>
    </header>

    <!-- search + filter section -->
    <div class="search-section">
      <div class="search-wrapper">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search by title or author... (e.g. transformer)">
        <button id="searchDummyBtn"><i class="fa-regular fa-filter"></i> <span class="hide-xs">refine</span></button>
      </div>
      <div class="filters" id="filterChipsContainer"></div>
    </div>

    <!-- results count & dynamic info -->
    <div class="results-header">
      <h3><i class="fa-regular fa-file-lines"></i> papers in your stream</h3>
      <span id="result-count">0 papers</span>
    </div>

    <!-- dynamic paper grid -->
    <div class="papers-grid" id="papersGrid"></div>
  </div>
<script>
(function() {

  let papers = [];
  let activeCategory = 'all';
  let searchTerm = '';

  const filterContainer = document.getElementById('filterChipsContainer');
  const papersGrid = document.getElementById('papersGrid');
  const searchInput = document.getElementById('searchInput');
  const resultCountSpan = document.getElementById('result-count');

  if (!filterContainer || !papersGrid) return;

  async function loadPapers() {
    try {
      const res = await fetch("/api/research/public");
      papers = await res.json();

      renderFilterChips();
      renderPapers();
    } catch (err) {
      console.error("Error loading papers", err);
    }
  }

  function renderFilterChips() {
    const categorySet = new Set(papers.map(p => p.subject));
    const categories = ['all', ...Array.from(categorySet)];

    filterContainer.innerHTML = '';

    categories.forEach(cat => {
      const chip = document.createElement('div');
      chip.className = `filter-chip ${activeCategory === cat ? 'active' : ''}`;
      chip.innerText = cat === 'all' ? 'All' : cat;

      chip.addEventListener('click', () => {
        activeCategory = cat;
        renderFilterChips();
        renderPapers();
      });

      filterContainer.appendChild(chip);
    });
  }

  function renderPapers() {
    const term = searchTerm.trim().toLowerCase();

    const filtered = papers.filter(p => {
      if (activeCategory !== 'all' && p.subject !== activeCategory) return false;

      if (term !== '') {
        return (
          p.title.toLowerCase().includes(term) ||
          p.author.toLowerCase().includes(term)
        );
      }
      return true;
    });

    resultCountSpan.innerText = `${filtered.length} papers`;

    if (filtered.length === 0) {
      papersGrid.innerHTML = `<div class="empty-message">No papers found</div>`;
      return;
    }

    let html = '';
    filtered.forEach(p => {
      html += `
        <div class="paper-card">
          <div class="card-header">
            <span class="category-tag">${p.subject}</span>
          </div>
          <div class="paper-title">${p.title}</div>
          <div class="paper-authors">${p.author}</div>
          <div class="paper-meta">
            <span>${p.year}</span>
            <span>•</span>
            <span>${p.journal || ''}</span>
          </div>
          <div class="paper-footer">
            <a href="${p.fileUrl}" target="_blank" class="read-link">
              Read paper →
            </a>
          </div>
        </div>
      `;
    });

    papersGrid.innerHTML = html;
  }

  searchInput.addEventListener('input', (e) => {
    searchTerm = e.target.value;
    renderPapers();
  });

  loadPapers();
})();
</script>


</body>
</html>